# üìò CRM Telegram Integration ‚Äî Project Guide

## 1. –û –ø—Ä–æ–µ–∫—Ç–µ
–≠—Ç–æ CRM-—Å–∏—Å—Ç–µ–º–∞ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π **Telegram Business**, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –æ—Ç–≤–µ—á–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞–º —Å –ø–æ–º–æ—â—å—é AI (OpenAI + RAG) –∏–ª–∏ –≤—Ä—É—á–Ω—É—é.

**–°—Ç–µ–∫:**
- **Frontend/Backend:** Next.js 16 (App Router)
- **Database:** Supabase (PostgreSQL)
- **AI:** OpenAI (GPT-4o)
- **Styling:** Tailwind CSS + Shadcn UI
- **Deploy:** Vercel (Production), Local + Ngrok (Dev)

## 2. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ó–∞–ø—É—Å–∫
```bash
npm install
npm run dev
```
–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω: `http://localhost:3000`

### –°–≤—è–∑—å —Å Telegram (Bot)
–ß—Ç–æ–±—ã –±–æ—Ç —Ä–∞–±–æ—Ç–∞–ª –ª–æ–∫–∞–ª—å–Ω–æ, –Ω—É–∂–µ–Ω –ø—É–±–ª–∏—á–Ω—ã–π HTTPS URL. –ò—Å–ø–æ–ª—å–∑—É–µ–º **ngrok**:
```bash
ngrok http 3000
```
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://d8cc...ngrok-free.app`) –∏ –æ–±–Ω–æ–≤–∏—Ç–µ `NEXT_PUBLIC_APP_URL` –≤ `.env.local`.
–ó–∞—Ç–µ–º –∑–∞–π–¥–∏—Ç–µ –≤ `http://localhost:3000/dashboard/settings` -> Telegram -> "–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞–Ω–æ–≤–æ".

## 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞–ø–∫–∏
- `app/` ‚Äî Next.js App Router (—Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ API).
  - `app/api/webhooks/telegram` ‚Äî –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
- `services/` ‚Äî –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞.
  - `telegram/telegram.service.ts` ‚Äî –ì–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–∏—Å. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, AI –ª–æ–≥–∏–∫–∞, —Å–ª—ç—à-–∫–æ–º–∞–Ω–¥—ã.
  - `openai.service.ts` ‚Äî –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ AI.
- `lib/` ‚Äî –£—Ç–∏–ª–∏—Ç—ã (Supabase client, Encryption).

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Supabase)
–ö–ª—é—á–µ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
- `integrations` ‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π Telegram Business. –•—Ä–∞–Ω–∏—Ç `bot_token` (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π).
- `conversations` ‚Äî –î–∏–∞–ª–æ–≥–∏ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏.
- `messages` ‚Äî –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π.

## 4. –î–µ–ø–ª–æ–π (Vercel)

### –ö–∞–∫ –æ–±–Ω–æ–≤–ª—è—Ç—å
1. –°–¥–µ–ª–∞–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ.
2. `git add . && git commit -m "..." && git push origin main`.
3. Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç –∏ –ø–µ—Ä–µ–¥–µ–ø–ª–æ–∏—Ç.

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (Vercel)
–í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–ø–∏—Å–∞–Ω—ã –≤ —Ñ–∞–π–ª–µ `VERCEL_INSTRUCTIONS.md` (–≤ –∫–æ—Ä–Ω–µ –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ). –ì–ª–∞–≤–Ω–æ–µ:
- `OPENAI_API_KEY`
- `TELEGRAM_BOT_TOKEN`
- `SUPABASE_*`
- `ENCRYPTION_KEY`
- `NEXT_PUBLIC_APP_URL` (–í–∞–∂–Ω–æ: –±–µ–∑ —Å–ª–µ—à–∞ –≤ –∫–æ–Ω—Ü–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä `https://crm-telegram.vercel.app`)

## 5. –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã (Troubleshooting)

### Webhook URL
–í `telegram.service.ts` –µ—Å—Ç—å –∑–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω—ã—Ö —Å–ª–µ—à–µ–π. URL —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ `${baseUrl}/api/...`. –ï—Å–ª–∏ –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Vercel (Functions) –∏ URL –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.

### HTML Entities
AI –∏–Ω–æ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `&nbsp;`, `<br>`. –í `telegram.service.ts` (—Ñ—É–Ω–∫—Ü–∏—è `triggerAIReply`) —Å—Ç–æ–∏—Ç `.replace()`, –æ—á–∏—â–∞—é—â–∏–π —ç—Ç–∏ —Ç–µ–≥–∏ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ Telegram, —Ç–∞–∫ –∫–∞–∫ Telegram —Ç—Ä–µ–±—É–µ—Ç —á–∏—Å—Ç—ã–π HTML (–∏–ª–∏ —Ç–µ–∫—Å—Ç).

### Vercel Starter Page
–ï—Å–ª–∏ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –≤–∏–¥–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ "Next.js Starter":
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `app/page.tsx` ‚Äî —Ç–∞–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `redirect("/dashboard")`.
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `package.json` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –∞ –Ω–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ.

## 6. –ü–æ–ª–µ–∑–Ω—ã–µ —Ñ–∞–π–ª—ã
- `VERCEL_INSTRUCTIONS.md` ‚Äî –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –¥–µ–ø–ª–æ—è.
- `legacy/` ‚Äî –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Å—Ç–∞—Ä–æ–≥–æ —Ö–æ—Å—Ç–∏–Ω–≥–∞ (Anora/AWS).

---
*Created by Antigravity*
